# 文章版本历史系统测试指南

## 测试环境准备

1. 确保后端服务正在运行
2. 确保前端开发服务器正在运行
3. 确保数据库连接正常，版本相关表已创建

## 功能测试步骤

### 1. 测试自动版本创建

#### 创建新文章测试
1. 访问文章创建页面 `/edit/new`
2. 填写文章信息并保存
3. 检查数据库 `article_versions` 表，应该有一条初始版本记录
4. 版本号应该为 1，存储类型应该为 `FULL_CONTENT`

#### 编辑文章测试
1. 访问任意文章详情页
2. 点击编辑按钮
3. 修改文章内容并保存
4. 检查数据库，应该新增一条版本记录
5. 版本号递增，存储类型根据差异大小确定

### 2. 测试版本历史查看

1. 在文章详情页点击右侧浮动按钮中的"历史"按钮
2. 应该跳转到 `/wiki/[文章标题]/history` 页面
3. 页面应该显示版本列表，包括：
   - 版本号
   - 作者
   - 创建时间
   - 存储类型标识
   - 文件大小信息
   - 压缩比（如果有）

### 3. 测试版本内容查看

1. 在版本历史页面
2. 点击任意版本的"查看"按钮
3. 应该弹出模态框显示该版本的内容
4. 内容应该是该版本时的文章内容

### 4. 测试版本对比

1. 在版本历史页面点击"版本对比"按钮
2. 选择两个不同的版本（注意提示信息）
3. 点击"开始对比"按钮
4. 应该弹出对比页面，左右并排显示两个版本的内容

### 5. 测试版本恢复

1. 在版本历史页面选择一个非最新的版本
2. 点击"恢复"按钮
3. 确认操作
4. 应该显示成功提示
5. 版本列表应该自动刷新，显示新创建的恢复版本
6. 检查数据库，应该有新的版本记录，变更摘要为"恢复到版本 X"

## 预期结果验证

### 数据库验证

#### article_versions 表
```sql
SELECT 
    version_id,
    article_id,
    version_number,
    author,
    created_at,
    storage_type,
    is_archived,
    change_summary,
    original_size,
    compressed_size
FROM article_versions 
WHERE article_id = [测试文章ID]
ORDER BY version_number DESC;
```

#### article_version_stats 表
```sql
SELECT 
    article_id,
    total_versions,
    base_versions_count,
    diff_versions_count,
    total_storage_size,
    compressed_storage_size
FROM article_version_stats 
WHERE article_id = [测试文章ID];
```

### 前端验证

1. **版本列表显示**：所有版本按时间倒序显示
2. **版本类型标识**：完整版本显示绿色标签，差异版本显示黄色/红色标签
3. **操作按钮**：查看、恢复按钮正常显示和工作
4. **分页功能**：如果版本超过20个，应该显示分页
5. **响应式设计**：在不同屏幕尺寸下正常显示

## 错误情况测试

### 1. 恢复相同版本
1. 尝试恢复到当前最新版本相同内容的版本
2. 应该显示错误提示："内容与当前版本相同，无需恢复"

### 2. 网络错误处理
1. 断网情况下尝试各种操作
2. 应该显示友好的错误提示
3. 提供重试机制

### 3. 权限错误
1. 如果实现了权限控制，测试无权限用户的操作
2. 应该显示权限不足的提示

## 性能测试

### 1. 大量版本测试
1. 为一篇文章创建大量版本（50+）
2. 测试版本列表加载速度
3. 测试分页功能
4. 测试版本内容加载速度

### 2. 大文件测试
1. 创建包含大量内容的文章版本
2. 测试版本创建时间
3. 测试版本内容加载时间
4. 测试压缩效果

## 故障排除

### 常见问题

1. **版本未自动创建**
   - 检查 ArticleService 中的版本服务注入
   - 检查控制台错误日志
   - 确认数据库表存在

2. **版本内容显示错误**
   - 检查差异重构逻辑
   - 确认压缩/解压功能正常
   - 检查基础版本是否存在

3. **恢复功能失败**
   - 检查恢复API端点是否正确
   - 确认请求格式正确
   - 检查后端日志

### 调试技巧

1. **后端调试**
   - 在关键方法添加日志
   - 使用断点调试版本创建逻辑
   - 检查数据库事务

2. **前端调试**
   - 使用浏览器开发者工具
   - 检查网络请求和响应
   - 查看Vue DevTools

## 测试数据建议

建议创建以下测试数据：

1. **短文章**：用于测试基础功能
2. **长文章**：用于测试压缩和差异存储
3. **多版本文章**：用于测试版本链重构
4. **特殊字符文章**：用于测试编码处理

通过以上测试步骤，可以全面验证文章版本历史系统的功能完整性和稳定性。
