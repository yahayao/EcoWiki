# 服务器配置 - 性能优化
server.port=8080
server.servlet.context-path=/api
server.tomcat.max-threads=200
server.tomcat.min-spare-threads=20
server.tomcat.max-connections=8192
server.tomcat.accept-count=100
server.tomcat.connection-timeout=20000

# 激活本地配置文件（包含敏感数据库信息）
spring.profiles.active=local

# MySQL数据库驱动配置
spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver

# JPA配置 - 重要：设置为none避免自动创建表
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.hibernate.ddl-auto=none  
# 改为none,手动管理表结构
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# 启用Hibernate二级缓存以提升性能 (暂时禁用以修复启动问题)
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false
# spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
# spring.jpa.properties.hibernate.javax.cache.provider=org.ehcache.jsr107.EhcacheCachingProvider

# MySQL连接池配置 - 性能优化
spring.datasource.hikari.maximum-pool-size=30
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# 移除H2控制台配置
# spring.h2.console.enabled=false

# CORS配置
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true

# 日志配置
logging.level.com.ecowiki=DEBUG
logging.level.org.springframework.web=DEBUG

# 显示映射信息
logging.level.org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping=TRACE

# 字符编码配置
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true
spring.http.encoding.charset=UTF-8
spring.http.encoding.enabled=true
spring.http.encoding.force=true

# 性能优化配置
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# 连接池监控
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# 文件上传配置
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB
spring.servlet.multipart.file-size-threshold=1MB

# 头像上传配置
avatar.upload.path=uploads/avatars/
avatar.max-size=5242880
server.base-url=http://localhost:8080

# JWT 配置
jwt.expiration=86400000
jwt.refresh-expiration=604800000

# 安全配置
security.password.min-length=6
security.session.timeout=3600

# 日志配置优化（生产环境建议）
logging.level.com.ecowiki=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN