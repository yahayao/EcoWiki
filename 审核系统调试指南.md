# æ–‡ç« å®¡æ ¸ç³»ç»Ÿè°ƒè¯•æŒ‡å—

## ğŸ” ç³»ç»Ÿè°ƒè¯•æ­¥éª¤

### 1. å‰ç«¯è°ƒè¯•

#### æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
```bash
# æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
# æŸ¥çœ‹ Console æ ‡ç­¾é¡µä¸­çš„é”™è¯¯ä¿¡æ¯
# æŸ¥çœ‹ Network æ ‡ç­¾é¡µä¸­çš„APIè¯·æ±‚çŠ¶æ€
```

#### å¸¸è§å‰ç«¯é—®é¢˜

**é—®é¢˜1: å®¡æ ¸åˆ—è¡¨æ— æ³•åŠ è½½**
```javascript
// æ£€æŸ¥APIè°ƒç”¨
console.log('API Base URL:', '/api/review');
console.log('Request Headers:', axios.defaults.headers);

// æ£€æŸ¥å“åº”æ•°æ®
axios.get('/api/review/list')
  .then(response => console.log('Response:', response.data))
  .catch(error => console.error('Error:', error));
```

**é—®é¢˜2: åˆ›å»ºå®¡æ ¸å¯¹è¯æ¡†æŠ¥é”™**
```javascript
// æ£€æŸ¥è¡¨å•æ•°æ®
console.log('Form Data:', {
  articleId: form.articleId,
  reviewType: form.reviewType,
  submitterId: form.submitterId
});

// æ£€æŸ¥ç±»å‹å®šä¹‰
import { ReviewType } from '@/types/review';
console.log('Available Review Types:', Object.values(ReviewType));
```

### 2. åç«¯è°ƒè¯•

#### æ£€æŸ¥æœåŠ¡å¯åŠ¨çŠ¶æ€
```bash
# æ£€æŸ¥Spring Bootåº”ç”¨æ˜¯å¦å¯åŠ¨æˆåŠŸ
curl http://localhost:8080/actuator/health

# æ£€æŸ¥å®¡æ ¸APIç«¯ç‚¹
curl http://localhost:8080/api/review/health
```

#### æ£€æŸ¥æ•°æ®åº“è¿æ¥
```sql
-- æ£€æŸ¥æ•°æ®åº“è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
SHOW TABLES LIKE '%review%';

-- æ£€æŸ¥è¡¨ç»“æ„
DESCRIBE article_review;
DESCRIBE reviewer_assignment;
DESCRIBE review_history;

-- æ£€æŸ¥åŸºç¡€æ•°æ®
SELECT COUNT(*) FROM article_review;
SELECT COUNT(*) FROM user_roles WHERE permission_name LIKE '%review%';
```

#### åç«¯æ—¥å¿—è°ƒè¯•
```java
// åœ¨ ArticleReviewService ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
@Slf4j
@Service
public class ArticleReviewService {
    
    public ArticleReview createReview(CreateReviewRequest request) {
        log.debug("åˆ›å»ºå®¡æ ¸ç”³è¯·: {}", request);
        
        try {
            // éªŒè¯æ–‡ç« æ˜¯å¦å­˜åœ¨
            if (!articleRepository.existsById(request.getArticleId())) {
                log.error("æ–‡ç« ä¸å­˜åœ¨: {}", request.getArticleId());
                throw new IllegalArgumentException("æ–‡ç« ä¸å­˜åœ¨");
            }
            
            // åˆ›å»ºå®¡æ ¸è®°å½•
            ArticleReview review = new ArticleReview();
            // ... è®¾ç½®å±æ€§
            
            ArticleReview saved = articleReviewRepository.save(review);
            log.info("å®¡æ ¸ç”³è¯·åˆ›å»ºæˆåŠŸ: {}", saved.getReviewId());
            
            return saved;
        } catch (Exception e) {
            log.error("åˆ›å»ºå®¡æ ¸ç”³è¯·å¤±è´¥", e);
            throw e;
        }
    }
}
```

### 3. æ•°æ®åº“è°ƒè¯•

#### æ£€æŸ¥æƒé™é…ç½®
```sql
-- æ£€æŸ¥ç”¨æˆ·è§’è‰²æƒé™
SELECT u.username, r.role_name, rp.permission_name, rp.permission_value
FROM users u
JOIN user_roles ur ON u.user_id = ur.user_id
JOIN roles r ON ur.role_id = r.role_id
JOIN role_permissions rp ON r.role_id = rp.role_id
WHERE rp.permission_name LIKE '%review%';

-- æ£€æŸ¥å®¡æ ¸å‘˜åˆ—è¡¨
SELECT u.user_id, u.username, COUNT(ar.review_id) as pending_reviews
FROM users u
JOIN user_roles ur ON u.user_id = ur.user_id
JOIN role_permissions rp ON ur.role_id = rp.role_id
LEFT JOIN article_review ar ON u.user_id = ar.reviewer_id AND ar.status = 'PENDING'
WHERE rp.permission_name = 'review.process' AND rp.permission_value = 'true'
GROUP BY u.user_id, u.username;
```

#### æ£€æŸ¥å®¡æ ¸æ•°æ®
```sql
-- æ£€æŸ¥å®¡æ ¸è®°å½•çŠ¶æ€åˆ†å¸ƒ
SELECT status, COUNT(*) as count
FROM article_review
GROUP BY status;

-- æ£€æŸ¥æœ€è¿‘çš„å®¡æ ¸è®°å½•
SELECT review_id, article_id, submitter_id, reviewer_id, status, submit_time
FROM article_review
ORDER BY submit_time DESC
LIMIT 10;

-- æ£€æŸ¥å®¡æ ¸å†å²è®°å½•
SELECT rh.*, u.username as operator_name
FROM review_history rh
JOIN users u ON rh.operator_id = u.user_id
ORDER BY rh.action_time DESC
LIMIT 10;
```

## ğŸ› å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: å®¡æ ¸å‘˜è‡ªåŠ¨åˆ†é…å¤±è´¥

**ç—‡çŠ¶**: åˆ›å»ºå®¡æ ¸åæ²¡æœ‰è‡ªåŠ¨åˆ†é…å®¡æ ¸å‘˜

**è°ƒè¯•æ­¥éª¤**:
1. æ£€æŸ¥æ˜¯å¦æœ‰å…·å¤‡å®¡æ ¸æƒé™çš„ç”¨æˆ·
2. æ£€æŸ¥è‡ªåŠ¨åˆ†é…ç®—æ³•æ˜¯å¦æ­£å¸¸
3. æ£€æŸ¥æ¶ˆæ¯æœåŠ¡æ˜¯å¦æ­£å¸¸

**è§£å†³æ–¹æ¡ˆ**:
```java
// åœ¨ ArticleReviewService ä¸­æ·»åŠ è°ƒè¯•ä»£ç 
public void assignReviewer(Integer reviewId) {
    log.debug("å¼€å§‹è‡ªåŠ¨åˆ†é…å®¡æ ¸å‘˜, reviewId: {}", reviewId);
    
    // 1. è·å–æ‰€æœ‰å®¡æ ¸å‘˜
    List<User> reviewers = getAvailableReviewers();
    log.debug("å¯ç”¨å®¡æ ¸å‘˜æ•°é‡: {}", reviewers.size());
    
    if (reviewers.isEmpty()) {
        log.error("æ²¡æœ‰å¯ç”¨çš„å®¡æ ¸å‘˜");
        throw new IllegalStateException("æ²¡æœ‰å¯ç”¨çš„å®¡æ ¸å‘˜");
    }
    
    // 2. é€‰æ‹©æœ€ä½³å®¡æ ¸å‘˜
    User bestReviewer = findBestReviewer(reviewers);
    log.debug("é€‰æ‹©çš„å®¡æ ¸å‘˜: {}", bestReviewer.getUsername());
    
    // 3. åˆ›å»ºåˆ†é…è®°å½•
    // ... åˆ†é…é€»è¾‘
}
```

### é—®é¢˜2: æ¶ˆæ¯é€šçŸ¥æœªå‘é€

**ç—‡çŠ¶**: å®¡æ ¸çŠ¶æ€å˜æ›´åç”¨æˆ·æœªæ”¶åˆ°é€šçŸ¥

**è°ƒè¯•æ­¥éª¤**:
```java
// æ£€æŸ¥æ¶ˆæ¯æœåŠ¡
@Autowired
private MessageService messageService;

public void sendNotification(Integer userId, String message) {
    try {
        log.debug("å‘é€æ¶ˆæ¯ç»™ç”¨æˆ· {}: {}", userId, message);
        messageService.sendMessage(userId, message);
        log.info("æ¶ˆæ¯å‘é€æˆåŠŸ");
    } catch (Exception e) {
        log.error("æ¶ˆæ¯å‘é€å¤±è´¥", e);
        // è¿™é‡Œå¯ä»¥æ·»åŠ é‡è¯•é€»è¾‘æˆ–è€…è®°å½•åˆ°å¤±è´¥é˜Ÿåˆ—
    }
}
```

### é—®é¢˜3: å‰ç«¯é¡µé¢ç©ºç™½æˆ–ç»„ä»¶åŠ è½½å¤±è´¥

**ç—‡çŠ¶**: å®¡æ ¸ç®¡ç†é¡µé¢æ˜¾ç¤ºç©ºç™½æˆ–ç»„ä»¶æŠ¥é”™

**è°ƒè¯•æ­¥éª¤**:
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æ£€æŸ¥Vueç»„ä»¶æ˜¯å¦æ­£ç¡®å¯¼å…¥
3. æ£€æŸ¥APIæ¥å£æ˜¯å¦æ­£å¸¸

**è§£å†³æ–¹æ¡ˆ**:
```vue
<template>
  <div class="review-dashboard">
    <!-- æ·»åŠ åŠ è½½çŠ¶æ€ -->
    <div v-if="loading" class="loading">
      æ­£åœ¨åŠ è½½å®¡æ ¸æ•°æ®...
    </div>
    
    <!-- æ·»åŠ é”™è¯¯çŠ¶æ€ -->
    <div v-else-if="error" class="error">
      <p>åŠ è½½å¤±è´¥: {{ error.message }}</p>
      <button @click="reload">é‡æ–°åŠ è½½</button>
    </div>
    
    <!-- æ­£å¸¸å†…å®¹ -->
    <div v-else>
      <!-- å®¡æ ¸ç®¡ç†å†…å®¹ -->
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';

const loading = ref(true);
const error = ref<Error | null>(null);

const loadReviewData = async () => {
  try {
    loading.value = true;
    error.value = null;
    
    // åŠ è½½æ•°æ®çš„é€»è¾‘
    await loadReviews();
    await loadStatistics();
    
  } catch (e: any) {
    console.error('åŠ è½½å®¡æ ¸æ•°æ®å¤±è´¥:', e);
    error.value = e;
  } finally {
    loading.value = false;
  }
};

const reload = () => {
  loadReviewData();
};

onMounted(() => {
  loadReviewData();
});
</script>
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ å¿…è¦çš„ç´¢å¼•
CREATE INDEX idx_article_review_status_time ON article_review(status, submit_time);
CREATE INDEX idx_reviewer_assignment_reviewer_status ON reviewer_assignment(reviewer_id, status);
CREATE INDEX idx_review_history_review_time ON review_history(review_id, action_time);

-- å®šæœŸæ¸…ç†å†å²æ•°æ®
DELETE FROM review_history 
WHERE action_time < DATE_SUB(NOW(), INTERVAL 1 YEAR);
```

### 2. å‰ç«¯æ€§èƒ½ä¼˜åŒ–

```vue
<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';

// ä½¿ç”¨åˆ†é¡µå‡å°‘æ•°æ®é‡
const pageSize = ref(20);
const currentPage = ref(1);

// ä½¿ç”¨è®¡ç®—å±æ€§ç¼“å­˜å¤„ç†ç»“æœ
const filteredReviews = computed(() => {
  return reviews.value.filter(review => {
    // ç­›é€‰é€»è¾‘
  });
});

// ä½¿ç”¨é˜²æŠ–å‡å°‘APIè°ƒç”¨
import { debounce } from 'lodash-es';

const searchReviews = debounce(async (keyword: string) => {
  // æœç´¢é€»è¾‘
}, 300);
</script>
```

### 3. åç«¯æ€§èƒ½ä¼˜åŒ–

```java
// ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“æŸ¥è¯¢
@Cacheable(value = "reviewStatistics", key = "#reviewerId")
public ReviewStatistics getReviewStatistics(Integer reviewerId) {
    // ç»Ÿè®¡é€»è¾‘
}

// ä½¿ç”¨å¼‚æ­¥å¤„ç†å‡å°‘å“åº”æ—¶é—´
@Async
public void sendNotificationAsync(Integer userId, String message) {
    messageService.sendMessage(userId, message);
}

// ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡
public void batchProcessReviews(List<Integer> reviewIds, String action) {
    List<ArticleReview> reviews = articleReviewRepository.findAllById(reviewIds);
    // æ‰¹é‡å¤„ç†é€»è¾‘
    articleReviewRepository.saveAll(reviews);
}
```

## ğŸ“Š ç›‘æ§å’Œå‘Šè­¦

### 1. å…³é”®æŒ‡æ ‡ç›‘æ§

```java
// æ·»åŠ ç›‘æ§æŒ‡æ ‡
@Component
public class ReviewMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Counter reviewCreatedCounter;
    private final Timer reviewProcessingTimer;
    
    public ReviewMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.reviewCreatedCounter = Counter.builder("review.created")
            .description("å®¡æ ¸åˆ›å»ºæ•°é‡")
            .register(meterRegistry);
        this.reviewProcessingTimer = Timer.builder("review.processing.time")
            .description("å®¡æ ¸å¤„ç†æ—¶é—´")
            .register(meterRegistry);
    }
    
    public void incrementReviewCreated() {
        reviewCreatedCounter.increment();
    }
    
    public void recordProcessingTime(Duration duration) {
        reviewProcessingTimer.record(duration);
    }
}
```

### 2. å¥åº·æ£€æŸ¥

```java
// æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
@RestController
@RequestMapping("/api/review")
public class ReviewHealthController {
    
    @GetMapping("/health")
    public ResponseEntity<Map<String, Object>> health() {
        Map<String, Object> status = new HashMap<>();
        
        try {
            // æ£€æŸ¥æ•°æ®åº“è¿æ¥
            long count = articleReviewRepository.count();
            status.put("database", "UP");
            status.put("reviewCount", count);
            
            // æ£€æŸ¥æ¶ˆæ¯æœåŠ¡
            boolean messageServiceUp = checkMessageService();
            status.put("messageService", messageServiceUp ? "UP" : "DOWN");
            
            status.put("status", "UP");
            return ResponseEntity.ok(status);
            
        } catch (Exception e) {
            status.put("status", "DOWN");
            status.put("error", e.getMessage());
            return ResponseEntity.status(503).body(status);
        }
    }
}
```

## ğŸ“ è°ƒè¯•æ—¥å¿—é…ç½®

```yaml
# application.yml ä¸­çš„æ—¥å¿—é…ç½®
logging:
  level:
    com.ecowiki.service.ArticleReviewService: DEBUG
    com.ecowiki.controller.ArticleReviewController: DEBUG
    org.springframework.web: DEBUG
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/review-system.log
    max-size: 100MB
    max-history: 30
```

---

**æç¤º**: é‡åˆ°é—®é¢˜æ—¶ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤é€ä¸€æ’æŸ¥ï¼Œå¹¶æŸ¥çœ‹ç›¸å…³æ—¥å¿—ä¿¡æ¯ã€‚å¦‚æœé—®é¢˜ä»æœªè§£å†³ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿã€‚
